<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kontrol Pintu Otomatis</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <style>
      body {
        background: #eef2f3;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .card-login {
        border: 1px solid #ddd;
        box-shadow: 0 1px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        gap: 2.5rem;
        width: 70%;
      }

      .card-login .left-content {
        flex: 1 1 40%;
      }

      .card-login .right-content {
        flex: 1 1 60%;
      }

      .swiper-slide img {
        display: block;
        width: 100%;
        height: 355px;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <main class="card-login p-5" id="login-form">
      <div class="left-content">
        <div class="header mb-3">
          <h3 class="fw-bold">Login eL Hotel</h3>
          <p>
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Saepe
            cumque deleniti ab, suscipit asperiores maiores?
          </p>
        </div>
        <div class="form">
          <div class="form-group mb-1">
            <label for="username" class="form-label"
              >Username<span class="text-danger">*</span></label
            >
            <input
              type="text"
              id="username"
              class="form-control mb-3"
              placeholder="Username"
              autocomplete="off"
            />
          </div>
          <div class="form-group mb-1">
            <label for="password" class="form-label"
              >Password<span class="text-danger">*</span></label
            >
            <input
              type="password"
              id="password"
              class="form-control mb-3"
              placeholder="Password"
              autocomplete="off"
            />
          </div>
          <button class="btn btn-success w-100 mt-3" onclick="login()">
            Login
          </button>
        </div>
      </div>
      <div class="right-content swiper imgLogin">
        <div class="swiper-wrapper">
          <div class="swiper-slide">
            <img src="images/building.png" alt="" />
          </div>
          <div class="swiper-slide">
            <img src="images/lobby.jpg" alt="" />
          </div>
          <div class="swiper-slide">
            <img src="images/bedroom.jpg" alt="" />
          </div>
          <div class="swiper-slide">
            <img src="images/swimming-pool.jpg" alt="" />
          </div>
        </div>
      </div>
    </main>

    <div class="card p-4 text-center d-none" id="user-igo" style="width: 370px">
      <h3 class="fw-bold mb-4">Selamat Datang Igo</h3>
      <button
        class="btn btn-success w-100 mb-2"
        onclick="updateStatus('igo', 1)"
      >
        üîì Buka
      </button>
      <button
        class="btn btn-primary w-100 mb-2"
        onclick="updateStatus('igo', 0)"
      >
        üîí Tutup
      </button>
      <p id="igoStatus" class="fw-bold text-secondary">
        Status: Pintu Tertutup ‚ùå
      </p>
      <button class="btn btn-danger w-100 mt-2" onclick="logout()">
        Keluar
      </button>
    </div>

    <div
      class="card p-4 text-center d-none"
      id="user-ismail"
      style="width: 370px"
    >
      <h3 class="fw-bold mb-4">Selamat Datang Ismail</h3>
      <button
        class="btn btn-success w-100 mb-2"
        onclick="updateStatus('ismail', 1)"
      >
        üîì Buka
      </button>
      <button
        class="btn btn-primary w-100 mb-2"
        onclick="updateStatus('ismail', 0)"
      >
        üîí Tutup
      </button>
      <p id="ismailStatus" class="fw-bold text-secondary">
        Status: Pintu Tertutup ‚ùå
      </p>
      <button class="btn btn-danger w-100 mt-2" onclick="logout()">
        Keluar
      </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
      const apiKeyWrite = "AGPIYM3P4IAIBVFU";
      const channelID = "3147685";
      const apiReadURL = `https://api.thingspeak.com/channels/${channelID}/feeds.json?results=1`;

      const users = [
        { username: "igo", password: "igo123", role: "igo" },
        { username: "ismail", password: "ismail123", role: "ismail" },
      ];

      window.onload = () => {
        const savedUser = localStorage.getItem("loggedUser");
        if (savedUser) {
          showUser(savedUser);
          loadStatus(savedUser);
        }
      };

      function login() {
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();
        const foundUser = users.find(
          (u) => u.username === username && u.password === password
        );
        if (foundUser) {
          localStorage.setItem("loggedUser", foundUser.role);
          showUser(foundUser.role);
          loadStatus(foundUser.role);
        } else {
          alert("Username atau password salah!");
        }
      }

      function showUser(role) {
        document.getElementById("login-form").classList.add("d-none");
        document
          .getElementById("user-igo")
          .classList.toggle("d-none", role !== "igo");
        document
          .getElementById("user-ismail")
          .classList.toggle("d-none", role !== "ismail");
      }

      function logout() {
        localStorage.removeItem("loggedUser");
        document.getElementById("login-form").classList.remove("d-none");
        document.getElementById("user-igo").classList.add("d-none");
        document.getElementById("user-ismail").classList.add("d-none");
        document.getElementById("username").value = "";
        document.getElementById("password").value = "";
      }

      async function updateStatus(user, status) {
        let field = "";
        let statusEl = null;
        if (user === "igo") {
          field = "field1";
          statusEl = document.getElementById("igoStatus");
        } else if (user === "ismail") {
          field = "field2";
          statusEl = document.getElementById("ismailStatus");
        }

        statusEl.innerText =
          status === 1
            ? "Status: Pintu Terbuka ‚úÖ"
            : "Status: Pintu Tertutup ‚ùå";

        const url = `https://api.thingspeak.com/update?api_key=${apiKeyWrite}&${field}=${status}`;
        try {
          const res = await fetch(url);
          if (!res.ok) console.error("ThingSpeak update gagal:", res.status);
          else
            console.log(`‚úÖ ${user.toUpperCase()} ubah status ke: ${status}`);
        } catch (err) {
          console.error("‚ùå Gagal kirim ke ThingSpeak", err);
        }
      }

      async function loadStatus(user) {
        try {
          const res = await fetch(apiReadURL);
          if (!res.ok)
            return console.error("Gagal load status ThingSpeak:", res.status);
          const data = await res.json();
          const feeds = data.feeds && data.feeds[0];
          if (!feeds) return;
          const field1 = feeds.field1;
          const field2 = feeds.field2;
          if (user === "igo") {
            document.getElementById("igoStatus").innerText =
              field1 == "1"
                ? "Status: Pintu Terbuka ‚úÖ"
                : "Status: Pintu Tertutup ‚ùå";
          } else if (user === "ismail") {
            document.getElementById("ismailStatus").innerText =
              field2 == "1"
                ? "Status: Pintu Terbuka ‚úÖ"
                : "Status: Pintu Tertutup ‚ùå";
          }
        } catch (err) {
          console.error("Gagal load status ThingSpeak", err);
        }
      }

      // swiper
      var swiper = new Swiper(".imgLogin", {
        spaceBetween: 20,
        loop: true,
        slidesPerView: "auto",
        autoplay: {
          delay: 5000,
          disableOnInteraction: false,
        },
        breakpoints: {
          0: {
            spaceBetween: 12,
          },
          480: {
            spaceBetween: 15,
          },
          767: {
            spaceBetween: 20,
          },
          992: {
            spaceBetween: 20,
          },
        },
      });
    </script>
  </body>
</html>
